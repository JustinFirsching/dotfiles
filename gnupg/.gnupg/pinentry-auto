#!/bin/sh
# Automatic pinentry selection wrapper
# macOS: use GUI pinentry-mac
# Linux: use terminal-based pinentry-curses

# macOS - use graphical pinentry
if [ "$(uname -s)" = "Darwin" ]; then
    # Homebrew (Apple Silicon)
    if [ -x "/opt/homebrew/bin/pinentry-mac" ]; then
        exec /opt/homebrew/bin/pinentry-mac "$@"
    # Homebrew (Intel)
    elif [ -x "/usr/local/bin/pinentry-mac" ]; then
        exec /usr/local/bin/pinentry-mac "$@"
    fi
fi

# Linux - use terminal-based pinentry
for pinentry in \
    /usr/bin/pinentry-curses \
    /usr/bin/pinentry-tty \
    /usr/bin/pinentry; do
    if [ -x "$pinentry" ]; then
        exec "$pinentry" "$@"
    fi
done

# Final fallback
echo "No pinentry program found!" >&2
exit 1
